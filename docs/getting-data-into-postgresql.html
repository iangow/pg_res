<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Modern Research Computing</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="Modern Research Computing">
  <meta name="generator" content="bookdown 0.3 and GitBook 2.6.7">

  <meta property="og:title" content="Modern Research Computing" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Modern Research Computing" />
  
  
  

<meta name="author" content="Ian D. Gow">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="the-backbone-the-relational-database.html">
<link rel="next" href="identifiers.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#a-taxonomy-of-data"><i class="fa fa-check"></i><b>1.1</b> A taxonomy of data</a><ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#project-specific-versus-general-data"><i class="fa fa-check"></i><b>1.1.1</b> Project-specific versus general data</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#why-a-relational-database"><i class="fa fa-check"></i><b>1.2</b> Why a relational database?</a><ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#alternative-1-data-files-in-statistical-package-of-choice"><i class="fa fa-check"></i><b>1.2.1</b> Alternative 1: Data files in statistical package of choice</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#why-postgresql"><i class="fa fa-check"></i><b>1.3</b> Why PostgreSQL?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="bad-practices-in-research.html"><a href="bad-practices-in-research.html"><i class="fa fa-check"></i><b>2</b> Bad practices in research</a><ul>
<li class="chapter" data-level="2.1" data-path="bad-practices-in-research.html"><a href="bad-practices-in-research.html#manual-steps-in-analysis"><i class="fa fa-check"></i><b>2.1</b> Manual steps in analysis</a></li>
<li class="chapter" data-level="2.2" data-path="bad-practices-in-research.html"><a href="bad-practices-in-research.html#manual-modification-of-data"><i class="fa fa-check"></i><b>2.2</b> Manual modification of data</a></li>
<li class="chapter" data-level="2.3" data-path="bad-practices-in-research.html"><a href="bad-practices-in-research.html#bad-or-no-documentation"><i class="fa fa-check"></i><b>2.3</b> Bad (or no) documentation</a></li>
<li class="chapter" data-level="2.4" data-path="bad-practices-in-research.html"><a href="bad-practices-in-research.html#poor-version-control"><i class="fa fa-check"></i><b>2.4</b> Poor version control</a></li>
<li class="chapter" data-level="2.5" data-path="bad-practices-in-research.html"><a href="bad-practices-in-research.html#limited-sharing-of-code-and-data"><i class="fa fa-check"></i><b>2.5</b> Limited sharing of code and data</a></li>
<li class="chapter" data-level="2.6" data-path="bad-practices-in-research.html"><a href="bad-practices-in-research.html#no-data-exploration"><i class="fa fa-check"></i><b>2.6</b> No data exploration</a></li>
<li class="chapter" data-level="2.7" data-path="bad-practices-in-research.html"><a href="bad-practices-in-research.html#casual-approach-to-merging-data-sets"><i class="fa fa-check"></i><b>2.7</b> Casual approach to merging data sets</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="the-backbone-the-relational-database.html"><a href="the-backbone-the-relational-database.html"><i class="fa fa-check"></i><b>3</b> The backbone: The relational database</a><ul>
<li class="chapter" data-level="3.1" data-path="the-backbone-the-relational-database.html"><a href="the-backbone-the-relational-database.html#handling-large-ish-data-sets"><i class="fa fa-check"></i><b>3.1</b> Handling large-ish data sets</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="getting-data-into-postgresql.html"><a href="getting-data-into-postgresql.html"><i class="fa fa-check"></i><b>4</b> Getting data into PostgreSQL</a><ul>
<li class="chapter" data-level="4.1" data-path="getting-data-into-postgresql.html"><a href="getting-data-into-postgresql.html#data-from-wrds"><i class="fa fa-check"></i><b>4.1</b> Data from WRDS</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="identifiers.html"><a href="identifiers.html"><i class="fa fa-check"></i><b>5</b> Identifiers</a><ul>
<li class="chapter" data-level="5.1" data-path="identifiers.html"><a href="identifiers.html#firm-identifiers-a-quiz"><i class="fa fa-check"></i><b>5.1</b> Firm identifiers: A quiz</a></li>
<li class="chapter" data-level="5.2" data-path="identifiers.html"><a href="identifiers.html#crsps-link-tables"><i class="fa fa-check"></i><b>5.2</b> CRSP’s link tables</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="application-firm-performance-over-time.html"><a href="application-firm-performance-over-time.html"><i class="fa fa-check"></i><b>6</b> Application: Firm performance over time</a></li>
<li class="chapter" data-level="7" data-path="application-event-returns.html"><a href="application-event-returns.html"><i class="fa fa-check"></i><b>7</b> Application: Event returns</a></li>
<li class="chapter" data-level="8" data-path="application-processing-textual-data.html"><a href="application-processing-textual-data.html"><i class="fa fa-check"></i><b>8</b> Application: Processing textual data</a></li>
<li class="chapter" data-level="9" data-path="application-hand-collection-of-data.html"><a href="application-hand-collection-of-data.html"><i class="fa fa-check"></i><b>9</b> Application: Hand-collection of data</a><ul>
<li class="chapter" data-level="9.1" data-path="application-hand-collection-of-data.html"><a href="application-hand-collection-of-data.html#google-sheets"><i class="fa fa-check"></i><b>9.1</b> Google Sheets</a></li>
<li class="chapter" data-level="9.2" data-path="application-hand-collection-of-data.html"><a href="application-hand-collection-of-data.html#text-annotation"><i class="fa fa-check"></i><b>9.2</b> Text annotation</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Modern Research Computing</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="getting-data-into-postgresql" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Getting data into PostgreSQL</h1>
<p>In this chapter I sketch some aspects of getting data into PostgreSQL from a variety of sources. Here are examples I consider</p>
<ul>
<li>Data from Wharton Research Data Services (WRDS)</li>
<li>Conference call transcripts from StreetEvents</li>
<li>Hand-collected data from Google Sheets</li>
<li>Excel worksheets from third parties</li>
</ul>
<div id="data-from-wrds" class="section level2">
<h2><span class="header-section-number">4.1</span> Data from WRDS</h2>
<p>A major source of data for finance and accounting research is WRDS. One way to access WRDS data is via WRDS’s new PostgreSQL database. You can use your WRDS ID to connect to this database. Here is how to connect using R:<a href="#fn16" class="footnoteRef" id="fnref16"><sup>16</sup></a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr, <span class="dt">warn.conflicts =</span> <span class="ot">FALSE</span>)
pg_wrds &lt;-<span class="st"> </span><span class="kw">src_postgres</span>(<span class="dt">host =</span> <span class="st">&quot;wrds-pgdata.wharton.upenn.edu&quot;</span>, <span class="dt">port =</span> <span class="dv">9737</span>,
                        <span class="dt">user =</span> <span class="st">&quot;iangow&quot;</span>, <span class="dt">dbname =</span> <span class="st">&quot;wrds&quot;</span>)</code></pre></div>
<p>Having connected to the database, one can access the WRDS data you have access to in much the same way as you might via SAS. For example, the CRSP daily stock file is in the table <code>dsf</code> in the <code>crsp</code> schema. Here we look at a few rows of this.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dsf &lt;-<span class="st"> </span><span class="kw">tbl</span>(pg_wrds, <span class="kw">sql</span>(<span class="st">&quot;SELECT * FROM crsp.dsf&quot;</span>))
dsf %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prc =</span> <span class="kw">abs</span>(prc)) %&gt;%
<span class="st">  </span><span class="kw">select</span>(permno, date, prc, ret)</code></pre></div>
<pre><code>## Source:   query [?? x 4]
## Database: postgres 9.5.5 [iangow@wrds-pgdata.wharton.upenn.edu:9737/wrds]
## 
##    permno       date     prc         ret
##     &lt;dbl&gt;     &lt;date&gt;   &lt;dbl&gt;       &lt;dbl&gt;
## 1   78712 2001-03-16 1.78125 -0.08064516
## 2   78712 2001-03-19 1.87500  0.05263158
## 3   78712 2001-03-20 1.87500  0.00000000
## 4   78712 2001-03-21 1.81250 -0.03333334
## 5   78712 2001-03-22 1.87500  0.03448276
## 6   78712 2001-03-23 1.81250 -0.03333334
## 7   78712 2001-03-26 1.78125 -0.01724138
## 8   78712 2001-03-27 1.81250  0.01754386
## 9   78712 2001-03-28 1.75000 -0.03448276
## 10  78712 2001-03-29 1.75000  0.00000000
## # ... with more rows</code></pre>
<p>While that’s one option for accessing WRDS data, it has its limitations. First, a common scenario is that one wants to merge data from WRDS with a large-ish data set of one’s own. Given that the WRDS database does not include your data, you’d need to pull the data from WRDS on one’s own machine and then merge. One can pull data into a local dataframe using the <code>dplyr</code> verb <code>collect()</code>. But <code>dsf %&gt;% collect()</code> is not something you want to be doing on a regular basis.</p>
<p>For WRDS data sets that you use in your research, I think it makes sense to have a copy of the data in your own database. While doing this uses up disk space and requires some time to download te data, the process for doing this is relatively painless.<a href="#fn17" class="footnoteRef" id="fnref17"><sup>17</sup></a></p>
<p>I use Python scripts to maintain my subset of WRDS, which includes data from Compustat, CRSP, and Capital IQ, among other data sets. These scripts are available at <a href="https://github.com/iangow/wrds_pg" class="uri">https://github.com/iangow/wrds_pg</a>.</p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="16">
<li id="fn16"><p>You will also need the <code>RPostgreSQL</code> package installed; you also need to supply your WRDS password, which could be done by adding <code>password = &quot;XXXXX&quot;</code> to the arguments to <code>src_postgres</code> below.<a href="getting-data-into-postgresql.html#fnref16">↩</a></p></li>
<li id="fn17"><p>An advantage of this approach is that the WRDS PostgreSQL database can be a little rough in places, with timestamps stored as text values and integers as floating point values.<a href="getting-data-into-postgresql.html#fnref17">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="the-backbone-the-relational-database.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="identifiers.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
